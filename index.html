<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockly (仮) - 日用品・在庫管理</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+JP:wght@400;700&family=M+PLUS+Rounded+1c:wght@700&family=Zen+Kaku+Gothic+New:wght@400;700&family=Exo+2:wght@600&family=Zen+Old+Mincho:wght@700&display=swap"
        rel="stylesheet">

    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Barcode Library (html5-qrcode) -->
    <script src="https://unpkg.com/html5-qrcode"></script>

    <!-- External Styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="theme-natural">

    <div class="container">
        <!-- View: Inventory -->
        <div id="view-inventory" class="view active">
            <header>
                <h1>Stockly (仮)</h1>
            </header>
            <div class="stat-grid">
                <div class="stat-card">
                    <div>不足 / 在庫切</div>
                    <div class="stat-value" id="count-out">0</div>
                </div>
                <div class="stat-card">
                    <div>期限間近</div>
                    <div class="stat-value" id="count-exp">0</div>
                </div>
            </div>
            <div style="margin-bottom:15px; display:flex; gap:10px;">
                <input type="text" id="main-search" placeholder="アイテムを探す..." oninput="renderItems()">
                <select id="filter-loc" style="width:130px" onchange="renderItems()">
                    <option value="">全ての場所</option>
                </select>
            </div>
            <div id="item-list"></div>
        </div>

        <!-- View: Settings -->
        <div id="view-settings" class="view">
            <header>
                <h1>設定とカスタマイズ</h1>
            </header>

            <div class="settings-card">
                <h2>デザインテーマの選択</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                    <button class="btn btn-secondary" onclick="setTheme('natural')">🌿 Natural</button>
                    <button class="btn btn-secondary" onclick="setTheme('cyber')">🚀 Cyber</button>
                    <button class="btn btn-secondary" onclick="setTheme('vivid')">🎨 Vivid</button>
                    <button class="btn btn-secondary" onclick="setTheme('retro')">📜 Retro</button>
                    <button class="btn btn-secondary" onclick="setTheme('mint')">🍬 Mint</button>
                    <button class="btn btn-secondary" onclick="setTheme('midnight')">🌑 Midnight</button>
                </div>
            </div>

            <div class="settings-card">
                <h2>場所(マスタ)の管理</h2>
                <div style="display:flex; gap:8px; margin-bottom:12px;">
                    <input type="text" id="new-loc-input" placeholder="新しい場所(例: 倉庫)" style="margin-bottom:0;">
                    <button class="btn btn-primary" style="padding: 0 20px;" onclick="addLocation()">追加</button>
                </div>
                <div id="location-tags" class="tag-list"></div>
            </div>

            <div class="settings-card" style="opacity:0.6;">
                <h2>システム</h2>
                <p style="font-size:0.8rem;">PHPサーバー連携を有効にすると、データのクラウド同期が可能になります。</p>
                <button class="btn btn-secondary" style="width:100%"
                    onclick="alert('PHP実装時に使用可能になります')">バックアップデータの出力</button>
                <button class="btn btn-secondary" style="width:100%; margin-top:10px; color:#ef4444;"
                    onclick="resetAll()">全データのリセット</button>
            </div>
        </div>
    </div>

    <!-- Tab Navigation Bar -->
    <nav class="tab-bar">
        <div class="tab-item active" id="tab-inventory" onclick="switchView('inventory')">
            <i data-lucide="home"></i><span>在庫一覧</span>
        </div>
        <div class="tab-item tab-item-center" onclick="openAddModal()">
            <div class="icon-bg"><i data-lucide="plus" style="width:32px; height:32px;"></i></div>
            <span>追加</span>
        </div>
        <div class="tab-item" id="tab-settings" onclick="switchView('settings')">
            <i data-lucide="settings-2"></i><span>設定</span>
        </div>
    </nav>

    <!-- Item Modal -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">アイテムを登録</h2>

            <!-- Scanner Area -->
            <div id="scanner-area" style="display:none;">
                <div id="reader"></div>
                <p style="text-align:center; font-size:0.8rem; margin:10px 0;">バーコードを枠に合わせてください。</p>
                <button class="btn btn-secondary" style="width:100%" onclick="stopScanner()">中断する</button>
            </div>

            <div id="form-area">
                <button class="btn btn-primary" style="width:100%; margin-bottom:15px; gap:8px;"
                    onclick="startScanner()">
                    <i data-lucide="scan-barcode"></i> バーコードスキャン
                </button>

                <label>アイテム名 *</label><input type="text" id="in-name" placeholder="商品名を入力..." required>

                <div style="display:flex; gap:10px;">
                    <div style="flex:2">
                        <label>保管場所</label><select id="in-loc"></select>
                    </div>
                    <div style="flex:1">
                        <label>現在の量</label><input type="number" id="in-qty" value="100">
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <div style="flex:1">
                        <label>単位</label><input type="text" id="in-unit" value="%">
                    </div>
                    <div style="flex:1">
                        <label>通知ライン</label><input type="number" id="in-threshold" value="20">
                    </div>
                </div>

                <label>期限 (賞味/消費/使用)</label><input type="date" id="in-expiry">

                <label>JANコード (読み取り結果)</label>
                <input type="text" id="in-barcode" placeholder="スキャンまたは直接入力" readonly>

                <div id="barcode-helper" style="display:none;" class="barcode-helper">
                    <span style="font-size:0.75rem;">JANコードから名前を検索:</span><br>
                    <div style="margin-top:5px; display:flex; gap:10px;">
                        <a href="#" id="link-yahoo" target="_blank"
                            style="color:var(--accent-color); font-size:0.9rem; font-weight:bold;">Yahoo!ショッピング</a>
                        <a href="#" id="link-google" target="_blank"
                            style="color:var(--accent-color); font-size:0.9rem; font-weight:bold;">Google検索</a>
                    </div>
                </div>

                <label>メモ</label><textarea id="in-memo" rows="2" placeholder="詰め替え用、お徳用パックなど"></textarea>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeModal()">キャンセル</button>
                    <button class="btn btn-primary" onclick="saveItem()">保存する</button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Script -->
    <script src="script.js"></script>
</body>

</html>